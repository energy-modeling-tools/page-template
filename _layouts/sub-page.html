{% include header.html %}

<script>
document.addEventListener('error', function(e) {
  var elem = e.target;
  if (elem.tagName.toLowerCase() === 'img' && !elem.dataset.imageRetry) {
    var src = elem.src;
    // 强制互相备选：jpg/jpeg -> png, png -> jpg
    var extMap = {
      'jpg': 'png', 'JPG': 'png', 'jpeg': 'png', 'JPEG': 'png',
      'png': 'jpg', 'PNG': 'jpg'
    };
    
    var match = src.match(/\.([a-zA-Z]+)(\?.*)?$/);
    if (match) {
      var ext = match[1];
      var targetExt = extMap[ext];
      
      if (targetExt) {
        elem.dataset.imageRetry = "true";
        var lastIndex = src.lastIndexOf('.');
        var newSrc = src.substring(0, lastIndex) + '.' + targetExt + src.substring(lastIndex + ext.length + 1);
        elem.src = newSrc;
      }
    }
  }
}, true);
</script>

</div>
    {{ content }}

{% include footer.html %}
